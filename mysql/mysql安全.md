### 什么是双1模式

#### 1、innodb_flush_log_at_trx_commit参数

这个参数控制了提交事务的时候是否保持高度的ACID属性，也就是说数据库的安全性。当然我们需要知道，安全性和高性能是一组对立面，想要MySQL实现高性能，就得舍弃一部分安全性，承担一定数据丢失的风险；相反，想要MySQL保证安全性，就要接受一部分性能损失。这个参数有3个指定的值，分别是0,1，2，它的默认值是1，这3个值的意思如下：

a、如果设置为0，那么MySQL数据库的log buffer将会每秒一次的写入到内核态的 os cache 中，并且 os cache 的 flush 操作，也就是刷新到磁盘操作将会同时进行。**也就是每秒一次写 os cache，每秒一次刷盘，事务提交的时候不会有任何动作。**

b、如果设置为1，每次事务提交的时候log buffer都会将数据写入os cache，并且flush到磁盘中去。**也就是说每次事务提交的时候，一次写 os cache，一次刷盘。**

c、如果设置为2，每次事务提交的时候log buffer将数据写入 os cache，但是不会进行flush 磁盘操作，而是每秒进行一次flush 磁盘操作。**也就是事务提交的时候一次写 os cache，每秒一次刷盘。**



#### 2、sync_binlog参数

```javascript
sync_binlog=0：
禁用MySQL服务器将二进制日志同步到磁盘。
相反，MySQL服务器依赖于操作系统来不时
地将二进制日志刷新到磁盘，就像对任何
其他文件一样。此设置提供最佳性能，
但在电源故障或操作系统崩溃的情况下，
服务器可能已提交尚未同步到二进制日志的事务。

sync_binlog=1：
在提交事务之前，允许将二进制日志同步
到磁盘。这是最安全的设置，但由于磁盘
写入次数增加，可能会对性能产生负面影响。
如果发生电源故障或操作系统崩溃，
二进制日志中缺少的事务仅处于准备状态。
这允许自动恢复例程回滚事务，
保证了二进制日志中没有丢失任何事务。

sync_binlog=N，其中N是0或1以外的值：
MySQL 在每写 N次 二进制日志binary log时，
会使用fdatasync()函数将它的写二进制日志
binary log同步到磁盘中去。如果发生操作系统崩溃，
服务器可能已提交尚未刷新到二进制日志的事务。
由于磁盘写入次数增加，此设置可能会对性能产生
负面影响。较高的值可提高性能，但会增加数据
丢失的风险。
```



**"双1模式"**

当innodb_flush_log_at_trx_commit和sync_binlog这两个参数都设置为1的时候，我们称之为"双1模式"。

"双1设置"适合数据安全性要求非常高，而且磁盘IO写能力足够支持业务，比如订单,交易,充值,支付消费系统。在mysql 服务崩溃或者服务器主机掉电的情况下，binary log 只有可能丢失最多一个语句或者一个事务，安全性能大大增加，但是我们说过，安全性和高性能是一把双刃剑，双1模式会导致频繁的io操作，因此该模式也是最慢的一种方式，影响数据库性能。